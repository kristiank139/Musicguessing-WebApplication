{% load static %}
<!--Leht, kus saab laulu mängida ja ära arvata-->
<!DOCTYPE html> 
<head>

<!--Võtab automaatsel playlist'i pealkirja-->
<title>{{ playlist.title }}</title>

<meta charset="utf-8">
  <!--Font Awesome, vajalik nuppude ja MediaPlayeri ilusaks tegemiseks-->
  <link href="https://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet"/>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/mediaelement/4.2.7/mediaelementplayer.min.css" rel="stylesheet"/>
  <link href="{% static './style.css' %}" rel="stylesheet"/>

  <!--Google'i API'st fondid Josefin Sans ja Roboto-->
  <link rel="preconnect" href="https://fonts.googleapis.com"> 
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin> 
  <link href="https://fonts.googleapis.com/css2?family=Josefin+Sans&display=swap" rel="stylesheet">   
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300&display=swap" rel="stylesheet">

  <!--Scriptid MediaPlayeri jaoks-->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mediaelement/4.2.7/mediaelement-and-player.min.js"></script>
  <script src="{% static './script.js' %}"></script>

</head>

<body>
<!--Form pealkirja ja autori kätte saamiseks-->
<div class="form">

  <div>
    <h1>Arva ära laul:</h1>
    <div>
      <label for="guessTitle">
        Pealkiri
      </label>
      <input type="text" id="guessTitle" name="guessTitle" class="animated-underline">
    </div>  
    <br>
    <div>
      <label for="guessAuthor">
        Autor
      </label>
      <input type="text" id="guessAuthor" name="guessAuthor" class="animated-underline">
    </div>
    <br>
    <div>
      <button type="button" id="check-button" class="button">Sisesta</button>
      <button type="button" id="answer" class="button">Õige vastus</button>
    </div>
    
  </div>

  <!--Siit edasi minna järgmisele laulule, kui vastus on õige-->
  <div>
    <form action='' method="post">
      {% csrf_token %}
      {{ form.as_p }}
      <button type="submit" id="next" class="inv button">Järgmine</button>
    </form>
  </div>
</div>
<!--Formi lõpp-->

<h2>Mängi laul:</h2>

<!--See on MediaPlayer, kus saab laulu mängida-->
<div class="contain">
  <div class="container">
      <div class="music-player">
          &nbsp; &nbsp; &nbsp; 
       <div class="player">
        <h1>{{item.title}}</h1>
        <audio class="fc-media" style="width: 100%;">
         <source src="{% if page_obj.audio_file %}{{page_obj.audio_file.url}} {% else %} {{page_obj.audio_link}} {% endif %}" type="audio/mp3"/>
        </audio>
        </div>
      </div>
  </div>
</div>
<!--MediaPlayer lõpp-->

</body>

<script>
  // Vajalik AJAX kood
  function guesscheck(guessTitleValue, guessAuthorValue) {
      $.ajax({
          type: "POST",
          url: "{% url 'App:playlist' playlist_id=playlist_id %}",
          data: {
              csrfmiddlewaretoken: '{{ csrf_token }}',
              guessTitle: guessTitleValue,
              guessAuthor: guessAuthorValue,
              song_id: "{{song_id}}",
          },
          success: function(response) {
              const correct = document.getElementById('correct');
              const wrong = document.getElementById('wrong');
              const button = document.getElementById('next');
              const guessTitle = response.guessTitle;
              const guessAuthor = response.guessAuthor;
              const guessTitleInput = document.getElementById("guessTitle");
              const guessAuthorInput = document.getElementById("guessAuthor");
              const checkButton = document.getElementById("check-button");

              if (guessTitleInput && guessTitle === 'correct') {
                guessTitleInput.disabled = true;
              } else {
                guessTitleInput.classList.add('red');
              }

              if (guessAuthorInput && guessAuthor === 'correct') {
                guessAuthorInput.disabled = true;
              } else {
                guessAuthorInput.classList.add('red');
              }

              if (guessTitle === 'correct' && guessAuthor === 'correct') {
                checkButton.disabled = true;
                wrong.classList.add('inv')
                correct.classList.remove('inv');
                button.classList.remove('inv')
              } else {
                wrong.classList.remove('inv');
              }
              
              console.log(response);
          },
          error: function(error) {
              console.log(error);
              // Handle error case
          }
      });
  }
  
$(document).ready(function() {
    $("#check-button").click(function() {
        // Sisendite väärtused
        const guessTitleValue = document.getElementById("guessTitle").value;
        const guessAuthorValue = document.getElementById("guessAuthor").value;
        console.log(guessAuthorValue)
        console.log(guessTitleValue)

        // Kutsun AJAX funktsiooni ja edastan guessTitleValue ja guessAuthorValue väärtused
        guesscheck(guessTitleValue, guessAuthorValue);
    });
});

$(document).ready(function() {
    $("#answer").click(function() {
        // Sisendite väärtused
        const guessTitleInput = document.getElementById("guessTitle");
        const guessAuthorInput = document.getElementById("guessAuthor");

        if (guessTitleInput.disabled === false) {
        document.getElementById("guessTitle").value = "{{page_obj.title}}".replace(/&quot;/g, '\"');
        }
        if (guessAuthorInput.disabled === false) {
        document.getElementById("guessAuthor").value = "{{page_obj.artist}}".replace(/&quot;/g, '\"');
        }
    });
});

</script>